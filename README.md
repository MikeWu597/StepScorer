# StepScorer

[English](README.md) | [中文](README_zh.md)

StepScorer is a machine learning project designed for scoring steps in sequential data. The model can be applied to various specific tasks such as evaluating grammar correctness, detecting discriminatory content, and other text evaluation tasks depending on the training data provided. Its usage is flexible and supports a wide range of sequential scoring applications. This repository provides tools for training models, performing inference, and visualizing results.

## Table of Contents
- [Dataset Preparation](#dataset-preparation)
- [Training](#training)
- [Inference](#inference)
- [Debugging](#debugging)
- [Model Structure](#model-structure)

## Dataset Preparation

Before training or running inference, you need to prepare your dataset in the appropriate format:

The project expects CSV data with three columns: standard, object, and score.

Example data structure:

```markdown
data/
└── sample_data.csv
```

Each row in the CSV should contain:
- standard: The evaluation criteria
- object: The item being evaluated
- score: The ground truth score (0-5 scale)

Example row:
```markdown
standard,object,score
"诗歌应押韵且有情感深度","秋叶飘零水自流，孤舟独坐忆故友。十年生死两茫茫，不思量，自难忘。",4.9
```

## Training

To train the StepScorer model, modify the CONFIG dictionary in [train.py](train.py) directly:

Key training configuration options in CONFIG:
- `data_path`: Path to your training data (default: 'data/sample_data.csv')
- `model_save_path`: File path where trained model will be saved (default: 'scoring_model.pt')
- `epochs`: Number of training epochs (default: 20)
- `batch_size`: Batch size for training (default: 24)
- `lr`: Learning rate for optimizer (default: 0.002)

During training, the model will:
1. Load and preprocess the training data
2. Initialize the model parameters
3. Run the training loop for the specified number of epochs
4. Save the best model based on validation loss

Simply run:
```bash
python train.py
```

## Inference

After training, you can use the [inference.py](inference.py) script to score new sequences.

Before running inference, update the CONFIG dictionary in [inference.py](inference.py):
- `model_path`: Path to the trained model checkpoint (default: 'scoring_model.pt')

Then run:
```bash
python inference.py
```

The inference script will:
1. Load the trained model
2. Prompt for standard and object inputs
3. Generate step scores for the sequence
4. Save the results in a structured format to 'scoring_steps.json'

## Debugging

For debugging and visualization purposes, use the [figure.py](figure.py) script to convert model outputs into images:

First, make sure you have a scoring result file (generated by inference.py):
- By default, this will be 'scoring_steps.json'

Then run:
```bash
python figure.py
```

This script helps with:
- Visualizing prediction results
- Showing cumulative score evolution over steps
- Displaying delta values per step
- Generating plots for analysis and presentation

The visualization will be saved as 'scoring_evolution.png'.

## Model Structure

The model architecture is defined in [model.py](model.py). Key components include:

### Core Architecture
- **BERT Encoder**: Processes input text using pre-trained BERT model (frozen)
- **GRU Module**: Models the sequential scoring process
- **Delta Predictor**: Predicts incremental score changes at each step
- **Accumulator**: Computes cumulative scores from deltas

### Key Features
- Uses BERT for semantic understanding of standards and objects
- Employs GRU to model the step-by-step scoring process
- Predicts score deltas rather than absolute scores at each step
- Applies masking to handle variable-length sequences properly
- Initializes GRU state with global context from the standard

### Model Parameters
Main hyperparameters that can be adjusted in the respective CONFIG dictionaries:
- Hidden layer dimensions (default: 128)
- Maximum steps (default: 100)
- Learning rate (default: 0.002)
- Batch size (default: 24)

Refer to [model.py](model.py) for detailed implementation.

## Requirements

All required packages are listed in [requirements.txt](file://e:\Dev\StepScorer\requirements.txt). Install them using:
```bash
pip install -r requirements.txt
```

## Contributing

Feel free to submit issues and pull requests to improve this project.